<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'><head><title>/home/rosejn/projects/icalendar/lib/icalendar/component.rb - C0 code coverage information</title><style type='text/css'>body { background-color: rgb(240, 240, 245); }</style><style type='text/css'>span.marked {
 background-color: rgb(185, 200, 200);
 display: block;
}
span.inferred {
 background-color: rgb(170, 185, 185);
 display: block;
}
span.overview {
 border-bottom: 8px solid black;
}
div.overview {
 border-bottom: 8px solid black;
}
body {
 font-family: verdana, arial, helvetica;
}
div.footer {
 font-size: 68%;
 margin-top: 1.5em;
}
h1, h2, h3, h4, h5, h6 {
 margin-bottom: 0.5em;
}
h5 {
 margin-top: 0.5em;
}
.hidden {
 display: none;
}
div.separator {
 height: 10px;
}
table tr td, table tr th {
 font-size: 68%;
}
td.value table tr td {
 font-size: 11px;
}
table.percent_graph {
 height: 12px;
 border: #808080 1px solid;
 empty-cells: show;
}
table.percent_graph td.covered {
 height: 10px;
 background: #00f000;
}
table.percent_graph td.uncovered {
 height: 10px;
 background: #e00000;
}
table.percent_graph td.NA {
 height: 10px;
 background: #eaeaea;
}
table.report {
 border-collapse: collapse;
 width: 100%;
}
table.report td.heading {
 background: #dcecff;
 border: #d0d0d0 1px solid;
 font-weight: bold;
 text-align: center;
}
table.report td.heading:hover {
 background: #c0ffc0;
}
table.report td.text {
 border: #d0d0d0 1px solid;
}
table.report td.value {
 text-align: right;
 border: #d0d0d0 1px solid;
}
</style><style type='text/css'>span.run0 {
  background-color: rgb(178, 204, 255);
  display: block;
}
span.run1 {
  background-color: rgb(178, 206, 255);
  display: block;
}
span.run2 {
  background-color: rgb(178, 209, 255);
  display: block;
}
span.run3 {
  background-color: rgb(178, 211, 255);
  display: block;
}
span.run4 {
  background-color: rgb(178, 214, 255);
  display: block;
}
span.run5 {
  background-color: rgb(178, 218, 255);
  display: block;
}
span.run6 {
  background-color: rgb(178, 220, 255);
  display: block;
}
span.run7 {
  background-color: rgb(178, 223, 255);
  display: block;
}
span.run8 {
  background-color: rgb(178, 225, 255);
  display: block;
}
span.run9 {
  background-color: rgb(178, 228, 255);
  display: block;
}
span.run10 {
  background-color: rgb(178, 232, 255);
  display: block;
}
span.run11 {
  background-color: rgb(178, 234, 255);
  display: block;
}
span.run12 {
  background-color: rgb(178, 237, 255);
  display: block;
}
span.run13 {
  background-color: rgb(178, 239, 255);
  display: block;
}
span.run14 {
  background-color: rgb(178, 242, 255);
  display: block;
}
span.run15 {
  background-color: rgb(178, 246, 255);
  display: block;
}
span.run16 {
  background-color: rgb(178, 248, 255);
  display: block;
}
span.run17 {
  background-color: rgb(178, 251, 255);
  display: block;
}
span.run18 {
  background-color: rgb(178, 253, 255);
  display: block;
}
span.run19 {
  background-color: rgb(178, 255, 253);
  display: block;
}
span.run20 {
  background-color: rgb(178, 255, 249);
  display: block;
}
span.run21 {
  background-color: rgb(178, 255, 247);
  display: block;
}
span.run22 {
  background-color: rgb(178, 255, 244);
  display: block;
}
span.run23 {
  background-color: rgb(178, 255, 242);
  display: block;
}
span.run24 {
  background-color: rgb(178, 255, 239);
  display: block;
}
span.run25 {
  background-color: rgb(178, 255, 235);
  display: block;
}
span.run26 {
  background-color: rgb(178, 255, 233);
  display: block;
}
span.run27 {
  background-color: rgb(178, 255, 230);
  display: block;
}
span.run28 {
  background-color: rgb(178, 255, 228);
  display: block;
}
span.run29 {
  background-color: rgb(178, 255, 225);
  display: block;
}
span.run30 {
  background-color: rgb(178, 255, 221);
  display: block;
}
span.run31 {
  background-color: rgb(178, 255, 219);
  display: block;
}
span.run32 {
  background-color: rgb(178, 255, 216);
  display: block;
}
span.run33 {
  background-color: rgb(178, 255, 214);
  display: block;
}
span.run34 {
  background-color: rgb(178, 255, 211);
  display: block;
}
span.run35 {
  background-color: rgb(178, 255, 207);
  display: block;
}
span.run36 {
  background-color: rgb(178, 255, 205);
  display: block;
}
span.run37 {
  background-color: rgb(178, 255, 202);
  display: block;
}
span.run38 {
  background-color: rgb(178, 255, 200);
  display: block;
}
span.run39 {
  background-color: rgb(178, 255, 197);
  display: block;
}
span.run40 {
  background-color: rgb(178, 255, 193);
  display: block;
}
span.run41 {
  background-color: rgb(178, 255, 191);
  display: block;
}
span.run42 {
  background-color: rgb(178, 255, 188);
  display: block;
}
span.run43 {
  background-color: rgb(178, 255, 186);
  display: block;
}
span.run44 {
  background-color: rgb(178, 255, 183);
  display: block;
}
span.run45 {
  background-color: rgb(178, 255, 179);
  display: block;
}
span.run46 {
  background-color: rgb(179, 255, 178);
  display: block;
}
span.run47 {
  background-color: rgb(182, 255, 178);
  display: block;
}
span.run48 {
  background-color: rgb(184, 255, 178);
  display: block;
}
span.run49 {
  background-color: rgb(187, 255, 178);
  display: block;
}
span.run50 {
  background-color: rgb(191, 255, 178);
  display: block;
}
span.run51 {
  background-color: rgb(193, 255, 178);
  display: block;
}
span.run52 {
  background-color: rgb(196, 255, 178);
  display: block;
}
span.run53 {
  background-color: rgb(198, 255, 178);
  display: block;
}
span.run54 {
  background-color: rgb(201, 255, 178);
  display: block;
}
span.run55 {
  background-color: rgb(205, 255, 178);
  display: block;
}
span.run56 {
  background-color: rgb(207, 255, 178);
  display: block;
}
span.run57 {
  background-color: rgb(210, 255, 178);
  display: block;
}
span.run58 {
  background-color: rgb(212, 255, 178);
  display: block;
}
span.run59 {
  background-color: rgb(215, 255, 178);
  display: block;
}
span.run60 {
  background-color: rgb(219, 255, 178);
  display: block;
}
span.run61 {
  background-color: rgb(221, 255, 178);
  display: block;
}
span.run62 {
  background-color: rgb(224, 255, 178);
  display: block;
}
span.run63 {
  background-color: rgb(226, 255, 178);
  display: block;
}
span.run64 {
  background-color: rgb(229, 255, 178);
  display: block;
}
span.run65 {
  background-color: rgb(233, 255, 178);
  display: block;
}
span.run66 {
  background-color: rgb(235, 255, 178);
  display: block;
}
span.run67 {
  background-color: rgb(238, 255, 178);
  display: block;
}
span.run68 {
  background-color: rgb(240, 255, 178);
  display: block;
}
span.run69 {
  background-color: rgb(243, 255, 178);
  display: block;
}
span.run70 {
  background-color: rgb(247, 255, 178);
  display: block;
}
span.run71 {
  background-color: rgb(249, 255, 178);
  display: block;
}
span.run72 {
  background-color: rgb(252, 255, 178);
  display: block;
}
span.run73 {
  background-color: rgb(255, 255, 178);
  display: block;
}
span.run74 {
  background-color: rgb(255, 252, 178);
  display: block;
}
span.run75 {
  background-color: rgb(255, 248, 178);
  display: block;
}
span.run76 {
  background-color: rgb(255, 246, 178);
  display: block;
}
span.run77 {
  background-color: rgb(255, 243, 178);
  display: block;
}
span.run78 {
  background-color: rgb(255, 240, 178);
  display: block;
}
span.run79 {
  background-color: rgb(255, 238, 178);
  display: block;
}
span.run80 {
  background-color: rgb(255, 234, 178);
  display: block;
}
span.run81 {
  background-color: rgb(255, 232, 178);
  display: block;
}
span.run82 {
  background-color: rgb(255, 229, 178);
  display: block;
}
span.run83 {
  background-color: rgb(255, 226, 178);
  display: block;
}
span.run84 {
  background-color: rgb(255, 224, 178);
  display: block;
}
span.run85 {
  background-color: rgb(255, 220, 178);
  display: block;
}
span.run86 {
  background-color: rgb(255, 218, 178);
  display: block;
}
span.run87 {
  background-color: rgb(255, 215, 178);
  display: block;
}
span.run88 {
  background-color: rgb(255, 212, 178);
  display: block;
}
span.run89 {
  background-color: rgb(255, 210, 178);
  display: block;
}
span.run90 {
  background-color: rgb(255, 206, 178);
  display: block;
}
span.run91 {
  background-color: rgb(255, 204, 178);
  display: block;
}
span.run92 {
  background-color: rgb(255, 201, 178);
  display: block;
}
span.run93 {
  background-color: rgb(255, 198, 178);
  display: block;
}
span.run94 {
  background-color: rgb(255, 196, 178);
  display: block;
}
span.run95 {
  background-color: rgb(255, 192, 178);
  display: block;
}
span.run96 {
  background-color: rgb(255, 189, 178);
  display: block;
}
span.run97 {
  background-color: rgb(255, 187, 178);
  display: block;
}
span.run98 {
  background-color: rgb(255, 184, 178);
  display: block;
}
span.run99 {
  background-color: rgb(255, 182, 178);
  display: block;
}
span.run100 {
  background-color: rgb(255, 178, 178);
  display: block;
}
</style></head><body><h3>C0 code coverage information generated on Sun May 21 00:51:54 CEST 2006</h3><hr /><pre><span class='marked'>Marked code looks like this.
This line is also marked as covered.
</span><span class='inferred'>Lines considered as run by rcov, but not reported by Ruby, look like this.
</span><span class='false'>Finally, here&apos;s a line marked as not executed.
</span></pre>    <table class='report'>
      <thead>
        <tr>
          <td class='heading'>Name</td>
          <td class='heading'>Total lines</td>
          <td class='heading'>Lines of code</td>
          <td class='heading'>Total coverage</td>
          <td class='heading'>Code coverage</td>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <a href='-home-rosejn-projects-icalendar-lib-icalendar-component_rb.html'>/home/rosejn/projects/icalendar/lib/icalendar/component.rb</a>
          </td>
          <td class='value'>
            <tt>384</tt>
          </td>
          <td class='value'>
            <tt>384</tt>
          </td>
          <td>
            <table cellspacing='0' cellpadding='0' align='right'>
              <tr>
                <td>
                  <tt>73.2%</tt>&nbsp;</td>
                <td>
                  <table cellspacing='0' class='percent_graph' cellpadding='0' width='100'>
                    <tr>
                      <td class='covered' width='73' />
                      <td class='uncovered' width='27' />
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
          </td>
          <td>
            <table cellspacing='0' cellpadding='0' align='right'>
              <tr>
                <td>
                  <tt>65.6%</tt>&nbsp;</td>
                <td>
                  <table cellspacing='0' class='percent_graph' cellpadding='0' width='100'>
                    <tr>
                      <td class='covered' width='66' />
                      <td class='uncovered' width='34' />
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </tbody>
    </table><pre><span class="false">  1 =begin
  2   Copyright (C) 2005 Jeff Rose
  3 
  4   This library is free software; you can redistribute it and/or modify it
  5   under the same terms as the ruby language itself, see the file COPYING for
  6   details.
  7 =end
</span><span class="marked">  8 
  9 module Icalendar
 10   # The body of the iCalendar object consists of a sequence of calendar
 11   # properties and one or more calendar components. The calendar
 12   # properties are attributes that apply to the calendar as a whole. The
 13   # calendar components are collections of properties that express a
 14   # particular calendar semantic. For example, the calendar component can
 15   # specify an Event, a Todo, a Journal entry, Timezone information, or
 16   # Freebusy time information, or an Alarm.
 17   class Component &lt; Icalendar::Base
 18 
 19     meta_include HashAttrs
 20 
 21     attr_reader :name
 22     attr_accessor :properties
 23 
 24     @@multi_properties = {}
 25 
 26     def initialize(name)
 27       @name = name
 28       @components = Hash.new([])
 29       @properties = {}
 30 
 31       @@logger.info(&quot;New #{@name[1,@name.size].capitalize}...&quot;)
 32     end
 33 
 34     # Add a sub-component to the current component object.
 35     def add_component(component)
 36       key = (component.class.to_s.downcase + 's').gsub('icalendar::', '').to_sym
 37 
 38       unless @components.has_key? key
 39         @components[key] = []
 40       end
 41 
 42       @components[key] &lt;&lt; component
 43     end
 44 
 45     # Add a component to the calendar.
 46     alias add add_component
 47 
 48     # Add an event to the calendar.
 49     alias add_event add_component
 50 
 51     # Add a todo item to the calendar.
 52     alias add_todo add_component
 53 
 54     # Add a journal item to the calendar.
 55     alias add_journal add_component
 56 
 57     def remove_component(component)
 58       key = (component.class.to_s.downcase + 's').gsub('icalendar::', '').to_sym
 59 
 60       if @components.has_key? key
 61         @components[key].delete(component)
 62       end
 63     end
 64 
 65     # Remove a component from the calendar.
 66     alias remove remove_component
 67 
 68     # Remove an event from the calendar.
 69     alias remove_event remove_component
 70 
 71     # Remove a todo item from the calendar.
 72     alias remove_todo remove_component
 73 
 74     # Remove a journal item from the calendar.
 75     alias remove_journal remove_component
 76 
 77     def to_ical
 78       print_component do
 79         s = &quot;&quot;
 80         @components.each_value do |comps|
 81           comps.each { |component| s &lt;&lt; component.to_ical }
 82         end
 83         s
 84       end
 85     end
 86 
 87     # Print this icalendar component
 88     def print_component
 89       # Begin a new component
 90       &quot;BEGIN:#{@name.upcase}\r\n&quot; +
 91 
 92       # Then the properties
 93       print_properties +
 94 
 95       # Any custom body of the derived component
 96       yield +
 97 
 98       # End of this component
 99       &quot;END:#{@name.upcase}\r\n&quot;
100     end
101 
102     # Print this components properties
103     def print_properties
104       s = &quot;&quot;
105 
106       @properties.each do |key,val| 
107 
108         # Take out underscore for property names that conflicted
109         # with built-in words.
110         if key =~ /ip_.*/
111           key = key[3..-1]
112         end
113 
114         # Property name
115         s &lt;&lt; &quot;#{key.upcase}&quot; + 
116 
117         # Possible parameters
118         print_parameters(val) + 
119 
120         # Property value
121         &quot;:#{val.to_ical}\r\n&quot; 
122       end
123 
124       s
125     end
126 
127     # Print the parameters for a specific property
128     def print_parameters(val)
129       s = &quot;&quot;
130       return s unless val.respond_to?(:ical_params) and not val.ical_params.nil?
131 
132       val.ical_params.each do |key,val|
133         s &lt;&lt; &quot;;#{key}&quot;
134         val = [ val ] unless val.is_a?(Array)
135 
136         # Possible parameter values
137         unless val.empty?
138           s &lt;&lt; &quot;=&quot;
139           sep = &quot;&quot; # First entry comes after = sign, but then we need commas
140           val.each do |pval| 
141             if pval.respond_to? :to_ical 
142               s &lt;&lt; sep &lt;&lt; pval.to_ical
143               sep = &quot;,&quot;
144             end
145           end
146         end
147       end
148       s
149     end
150 
151     # TODO: Look into the x-property, x-param stuff...
152     def custom_property(name, value)
</span><span class="false">153       @properties[name] = value
154     end
</span><span class="marked">155 
156     def multi_property?(name)
157       @@multi_properties.has_key?(name.downcase)
158     end
159 
160     # Make it protected so we can monitor usage...
161     protected
162 
163     def Component.ical_component(*syms)
164       hash_accessor :@components, *syms
165     end
166 
167     # Define a set of methods supporting a new property
168     def Component.ical_property(property, alias_name = nil, prop_name = nil)
169       property = &quot;#{property}&quot;.strip.downcase
170       alias_name = &quot;#{alias_name}&quot;.strip.downcase unless alias_name.nil?
171 
172       # If a prop_name was given then we use that for the actual storage
173       property = &quot;#{prop_name}&quot;.strip.downcase unless prop_name.nil?
174 
175       generate_getter(property, alias_name)
176       generate_setter(property, alias_name)
177       generate_query(property, alias_name)
178     end
179     
180     # Define a set of methods defining a new property, which 
181     # supports multiple values for the same property name.
182     def Component.ical_multi_property(property, singular, plural)
183       property = &quot;#{property}&quot;.strip.downcase.gsub(/-/, '_')
184       plural = &quot;#{plural}&quot;.strip.downcase
185 
186       # Set this key so the parser knows to use an array for
187       # storing this property type.
188       @@multi_properties[&quot;#{property}&quot;] = true
189 
190       generate_multi_getter(property, plural)
191       generate_multi_setter(property, plural)
192       generate_multi_query(property, plural)
193       generate_multi_adder(property, singular)
194       generate_multi_remover(property, singular)
195     end
196 
197     private
198 
199     def Component.generate_getter(property, alias_name)
200       unless instance_methods.include? property
201         code = &lt;&lt;-code
</span><span class="false">202             def #{property}(val = nil, params = nil)
203               return @properties[&quot;#{property}&quot;] if val.nil?
204 
205               unless val.respond_to?(:to_ical)
206                 raise(NotImplementedError, &quot;Value of type (&quot; + val.class.to_s + &quot;) does not support to_ical method!&quot;)
207               end
208 
209               unless params.nil?
210                 # Extend with the parameter methods only if we have to...
211                 unless val.respond_to?(:ical_params) 
212                   val.class.class_eval { attr_accessor :ical_params }
213                 end
214                 val.ical_params = params
215               end
216 
217               @properties[&quot;#{property}&quot;] = val
218             end
219         code
</span><span class="marked">220 
221         class_eval code, &quot;component.rb&quot;, 219
222         alias_method(&quot;#{alias_name}&quot;, &quot;#{property}&quot;) unless alias_name.nil?
223       end
224     end
225 
226     def Component.generate_setter(property, alias_name)
227       setter = property + '='
228       unless instance_methods.include? setter
229         code = &lt;&lt;-code
</span><span class="false">230             def #{setter}(val)
231               #{property}(val)
232             end
233         code
</span><span class="marked">234 
235         class_eval code, &quot;component.rb&quot;, 233
236         alias_method(&quot;#{alias_name}=&quot;, &quot;#{property+'='}&quot;) unless alias_name.nil?
237       end
238     end
239 
240     def Component.generate_query(property, alias_name)
241       query = &quot;#{property}?&quot;
242       unless instance_methods.include? query
243         code = &lt;&lt;-code
</span><span class="false">244             def #{query}
245               @properties.has_key?(&quot;#{property.downcase}&quot;)
246             end
247         code
</span><span class="marked">248 
249         class_eval code, &quot;component.rb&quot;, 226
250 
251         alias_method(&quot;#{alias_name}\?&quot;, &quot;#{query}&quot;) unless alias_name.nil?
252       end    
253     end
254 
255     def Component.generate_multi_getter(property, plural)     
256       # Getter for whole array
257       unless instance_methods.include? plural
258         code = &lt;&lt;-code
</span><span class="false">259             def #{plural}(a = nil)
260               if a.nil?
261                 @properties[&quot;#{property}&quot;] || []
262               else
263                 self.#{plural}=(a)
264               end 
265             end
266         code
</span><span class="marked">267 
268         class_eval code, &quot;component.rb&quot;, 186
269       end
270     end
271 
272     def Component.generate_multi_setter(property, plural)
273       # Setter for whole array
274       unless instance_methods.include? plural+'+'
275         code = &lt;&lt;-code
</span><span class="false">276             def #{plural}=(a)
277               if a.respond_to?(:to_ary)
278                 a.to_ary.each do |val|
279                   unless val.respond_to?(:to_ical)
280                     raise(NotImplementedError, &quot;Property values do not support to_ical method!&quot;)
281                   end
282                 end
283 
284                 @properties[&quot;#{property}&quot;] = a.to_ary
285               else
286                 raise ArgumentError, &quot;#{plural} is a multi-property that must be an array! Use the add_[property] method to add single entries.&quot;
287               end
288             end
289         code
</span><span class="marked">290 
291         class_eval code, &quot;component.rb&quot;, 198
292       end
293     end
294 
295     def Component.generate_multi_query(property, plural)
296       # Query for any of these properties
297       unless instance_methods.include? plural+'?'
298         code = &lt;&lt;-code
</span><span class="false">299             def #{plural}?
300               @properties.has_key?(&quot;#{property}&quot;)
301             end
302         code
</span><span class="marked">303 
304         class_eval code, &quot;component.rb&quot;, 210
305       end
306     end
307 
308     def Component.generate_multi_adder(property, singular)
309       adder = &quot;add_&quot;+singular.to_s
310       # Add another item to this properties array
311       unless instance_methods.include? adder
312         code = &lt;&lt;-code
</span><span class="false">313             def #{adder}(val, params = {})
314               unless val.respond_to?(:to_ical)
315                 raise(NotImplementedError, &quot;Property value object does not support to_ical method!&quot;)
316               end
317 
318               unless params.nil?
319                 # Extend with the parameter methods only if we have to...
320                 unless val.respond_to?(:ical_params) 
321                   val.class.class_eval { attr_accessor :ical_params }
322                 end
323                 val.ical_params = params
324               end
325 
326               if @properties.has_key?(&quot;#{property}&quot;)
327                 @properties[&quot;#{property}&quot;] &lt;&lt; val
328               else
329                 @properties[&quot;#{property}&quot;] = [val]
330               end
331             end
332         code
</span><span class="marked">333 
334         class_eval code, &quot;component.rb&quot;, 289
335         alias_method(&quot;add_#{property.downcase}&quot;, &quot;#{adder}&quot;) 
336       end
337     end
338 
339     def Component.generate_multi_remover(property, singular)
340       # Remove an item from this properties array
341       unless instance_methods.include? &quot;remove_#{singular}&quot;
342         code = &lt;&lt;-code
</span><span class="false">343             def remove_#{singular}(a)
344               if @properties.has_key?(&quot;#{property}&quot;)
345                 @properties[&quot;#{property}&quot;].delete(a)
346               end
347             end
348         code
</span><span class="marked">349 
350         class_eval code, &quot;component.rb&quot;, 303
351         alias_method(&quot;remove_#{property.downcase}&quot;, &quot;remove_#{singular}&quot;)
352       end
353     end
354 
355     def method_missing(method_name, *args)
</span><span class="false">356       method_name = method_name.to_s.downcase
357 
358       unless method_name =~ /x_.*/
359         raise NoMethodError, &quot;Method Name: #{method_name}&quot;
360       end
361 
362       val = args.first
363 
364       if method_name =~ /(.*)(=)/ # Its a setter
365         @properties[$1] = val
366         @@logger.debug(&quot;Setting #{$1} =&gt; #{val}&quot;)
367       else # Or its a getter
368         @@logger.debug(&quot;Getting #{method_name} =&gt; #{@properties[method_name]}&quot;)
369         return @properties[method_name]
370       end
371     end
</span><span class="marked">372 
373     public
374 
375     def respond_to?(method_name)
376       unless method_name.to_s.downcase =~ /x-.*/
377         super
378       end
379 
380       true
381     end
382 
383   end # class Component
384 end
</span></pre><hr /><p><a href='http://validator.w3.org/check/referer'><img src='http://www.w3.org/Icons/valid-xhtml10' height='31' alt='Valid XHTML 1.0!' width='88' /></a><a href='http://jigsaw.w3.org/css-validator/check/referer'><img src='http://jigsaw.w3.org/css-validator/images/vcss' alt='Valid CSS!' style='border:0;width:88px;height:31px' /></a></p></body></html>
